# Solution Generator - Question Response Formats

This document explains how questions are formatted in **BULK** vs **INDIVIDUAL** solving approaches.

---

## üìä **BULK SOLUTION RESPONSE FORMAT**

### **Input to Gemini:**
All PDF questions sent at once (up to 50,000 characters) with a structured prompt.

### **Expected Output from Gemini:**
```
========================================================================

SECTION: QUANTITATIVE APTITUDE

========================================================================

------------------------------------------------------------------------

Question 1: Find ratio of total students in 2012-2013 to 2014-2015

Options: 1) 11:15 | 2) 9:17 | 3) 13:14 | 4) 7:9 | 5) 10:17

CORRECT ANSWER: 2) 9:17

SOLUTION:

2012+2013: (20+30+40)+(30+40+20) = 180 Lakhs
2014+2015: (40+50+30)+(50+40+30) = 240 Lakhs  
Ratio = 180:240 = 9:17

------------------------------------------------------------------------

Question 2: Class B Group X students as percentage of Class C Group Y students?

Options: 1) 120% | 2) 140% | 3) 160% | 4) 125% | 5) 100%

CORRECT ANSWER: 3) 160%

SOLUTION:

Class B, Group X = (8/16) * 80 = 40 students
Class C, Group Y = (6/12) * 50 = 25 students
Percentage = (40/25) * 100 = 160%

------------------------------------------------------------------------

========================================================================

SECTION: LOGICAL REASONING

========================================================================

------------------------------------------------------------------------

Question 15: If P then Q logic problem...

Options: 1) A | 2) B | 3) C | 4) D

CORRECT ANSWER: 2) B

SOLUTION:

Uses Modus Ponens: If P then Q, P is true, therefore Q

------------------------------------------------------------------------
```

### **Parsed JSON Structure (after `_parse_structured_solution()`):**
```json
[
  {
    "question_number": "1",
    "question_text": "Find ratio of total students in 2012-2013 to 2014-2015",
    "question_body": "Find ratio of total students in 2012-2013 to 2014-2015",
    "options": [
      {"label": "1", "text": "11:15"},
      {"label": "2", "text": "9:17"},
      {"label": "3", "text": "13:14"},
      {"label": "4", "text": "7:9"},
      {"label": "5", "text": "10:17"}
    ],
    "answer": "2) 9:17",
    "answer_option": "2",
    "explanation": "2012+2013: (20+30+40)+(30+40+20) = 180 Lakhs\n2014+2015: (40+50+30)+(50+40+30) = 240 Lakhs\nRatio = 180:240 = 9:17",
    "method": "llm_structured",
    "section": "QUANTITATIVE APTITUDE"
  },
  {
    "question_number": "2",
    "question_text": "Class B Group X students as percentage of Class C Group Y students?",
    "question_body": "Class B Group X students as percentage of Class C Group Y students?",
    "options": [
      {"label": "1", "text": "120%"},
      {"label": "2", "text": "140%"},
      {"label": "3", "text": "160%"},
      {"label": "4", "text": "125%"},
      {"label": "5", "text": "100%"}
    ],
    "answer": "3) 160%",
    "answer_option": "3",
    "explanation": "Class B, Group X = (8/16) * 80 = 40 students\nClass C, Group Y = (6/12) * 50 = 25 students\nPercentage = (40/25) * 100 = 160%",
    "method": "llm_structured",
    "section": "QUANTITATIVE APTITUDE"
  }
]
```

**Key Features:**
- ‚úÖ All questions solved in **ONE API call**
- ‚úÖ **Section headers** preserved (e.g., "QUANTITATIVE APTITUDE")
- ‚úÖ Structured format with separators (`========`, `--------`)
- ‚úÖ Method: `"llm_structured"`

---

## üîÑ **INDIVIDUAL SOLUTION RESPONSE FORMAT**

### **Process:**
Each question is solved **one at a time** using segmentation.

### **Step 1: Question Segmentation**
Questions are extracted from PDF using regex patterns:
```
"1. What is the capital of France?\n1) Paris\n2) London\n3) Berlin\n4) Madrid"
```

### **Step 2: Solving Methods (Priority Order)**

#### **Method 1: Answer Key** (if available in PDF)
```json
{
  "question_number": "1",
  "question_text": "What is the capital of France?",
  "question_body": "What is the capital of France?",
  "options": [
    {"label": "1", "text": "Paris"},
    {"label": "2", "text": "London"},
    {"label": "3", "text": "Berlin"},
    {"label": "4", "text": "Madrid"}
  ],
  "answer": "1) Paris",
  "answer_option": "1",
  "explanation": "[Generated by LLM since answer key used]",
  "method": "answer_key"
}
```

#### **Method 2: SymPy** (for mathematical equations)
```json
{
  "question_number": "5",
  "question_text": "Solve for x: 2x + 5 = 13",
  "question_body": "Solve for x: 2x + 5 = 13",
  "options": [],
  "answer": "4",
  "answer_option": null,
  "explanation": "Solved automatically with SymPy.",
  "method": "sympy"
}
```

#### **Method 3: Gemini LLM** (for complex questions)
**Input Prompt:**
```
You are an expert exam solver. Extract and solve every question and MCQ from the text below.

For each question:
- Detect the question number if present.
- Copy the full question text exactly as written.
- Identify the correct answer using reasoning.
- If the question is MCQ, DO NOT return "Option 1/2/3/4/5".
  Instead, return the ACTUAL ANSWER TEXT. Example:
  - Correct: "Carbon dioxide"
  - Wrong: "Option C" or "Option 3"
- For non-MCQs, return the solved final answer clearly.
- Provide a concise 2-line explanation for how you got the answer.

Output Format (STRICT):
Return ONLY a valid JSON array:
[
  {
    "question_number": "...",
    "question_text": "...",
    "answer": "...",  
    "explanation": "..."
  }
]
```

**Expected Output from Gemini:**
```json
[
  {
    "question_number": "10",
    "question_text": "Which gas is released during photosynthesis?",
    "answer": "Oxygen",
    "explanation": "During photosynthesis, plants absorb CO2 and release O2 as a byproduct."
  }
]
```

**Parsed JSON Structure (after processing):**
```json
{
  "question_number": "10",
  "question_text": "Which gas is released during photosynthesis?\n1) Carbon dioxide\n2) Oxygen\n3) Nitrogen\n4) Hydrogen",
  "question_body": "Which gas is released during photosynthesis?",
  "options": [
    {"label": "1", "text": "Carbon dioxide"},
    {"label": "2", "text": "Oxygen"},
    {"label": "3", "text": "Nitrogen"},
    {"label": "4", "text": "Hydrogen"}
  ],
  "answer": "Oxygen",
  "answer_option": null,
  "explanation": "During photosynthesis, plants absorb CO2 and release O2 as a byproduct.",
  "method": "gemini"
}
```

**Key Features:**
- ‚ö†Ô∏è Each question = **ONE API call** (slower, more expensive)
- ‚ö†Ô∏è No section headers
- ‚úÖ Handles edge cases better
- Methods: `"answer_key"`, `"sympy"`, `"gemini"`, or `"error"`

---

## üîÑ **FINAL OUTPUT FORMAT (Both Approaches)**

After solving, **BOTH** approaches produce the **SAME JSON structure**:

```json
{
  "question_number": "1",
  "question_text": "Full question with options formatted",
  "question_body": "Question text only (without options)",
  "options": [
    {"label": "1", "text": "Option 1 text"},
    {"label": "2", "text": "Option 2 text"},
    {"label": "3", "text": "Option 3 text"},
    {"label": "4", "text": "Option 4 text"}
  ],
  "answer": "Correct answer text (e.g., '2) Option 2 text' or 'Oxygen')",
  "answer_option": "2",
  "explanation": "Step-by-step explanation",
  "method": "llm_structured" | "answer_key" | "sympy" | "gemini",
  "section": "SECTION NAME" // Only in bulk method
}
```

---

## üåç **TRANSLATION FORMAT**

### **Input Format (sent to Gemini for translation):**
```
Q1: Find ratio of total students in 2012-2013 to 2014-2015
Options: 1) 11:15 | 2) 9:17 | 3) 13:14 | 4) 7:9 | 5) 10:17
‚úÖ Answer: 2) 9:17
üìù Solution: [Explanation text]
‚ïê‚ïê‚ïê

Q2: Class B Group X students as percentage...
Options: 1) 120% | 2) 140% | 3) 160% | 4) 125% | 5) 100%
‚úÖ Answer: 3) 160%
üìù Solution: [Explanation text]
‚ïê‚ïê‚ïê
```

### **Expected Translated Output (same format, translated):**
```
Q1: [Translated question text]
Options: 1) [Translated] | 2) [Translated] | 3) [Translated] | 4) [Translated] | 5) [Translated]
‚úÖ Answer: 2) [Translated answer]
üìù Solution: [Translated explanation]
‚ïê‚ïê‚ïê
```

### **Final Translated JSON Structure:**
```json
{
  "question_number": "1",
  "question_text": "Original English text",
  "question_body": "Original English text",
  "question_text_telugu": "[Translated to Telugu]",
  "question_body_telugu": "[Translated to Telugu]",
  "options": [
    {"label": "1", "text": "Original English"},
    {"label": "2", "text": "Original English"}
  ],
  "options_telugu": [
    {"label": "1", "text": "[Translated to Telugu]"},
    {"label": "2", "text": "[Translated to Telugu]"}
  ],
  "answer": "Original English answer",
  "answer_telugu": "[Translated to Telugu]",
  "explanation": "Original English explanation",
  "explanation_telugu": "[Translated to Telugu]",
  "method": "llm_structured",
  "section": "QUANTITATIVE APTITUDE"
}
```

---

## üìù **DOCX OUTPUT FORMAT**

Final document uses translated fields (e.g., `question_body_telugu`, `answer_telugu`) or falls back to English:

```
**‡∞™‡∞∞‡∞ø‡∞∑‡±ç‡∞ï‡∞æ‡∞∞‡∞æ‡∞≤‡±Å**  (Solutions title in Telugu)

Question 1: [Translated question text]
1) [Translated option 1]
2) [Translated option 2]
3) [Translated option 3]
4) [Translated option 4]
‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞®: [Translated answer]  (Answer label in Telugu)
‡∞µ‡∞ø‡∞µ‡∞∞‡∞£: [Translated explanation]  (Explanation label in Telugu)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Question 2: [Translated question text]
...
```

---

## ‚ö° **PERFORMANCE COMPARISON**

| Aspect | Bulk Method | Individual Method |
|--------|-------------|-------------------|
| **API Calls** | 1 call for all questions | N calls (1 per question) |
| **Speed** | Fast (single request) | Slow (multiple requests) |
| **Cost** | Low (1 API call) | High (N API calls) |
| **Section Support** | ‚úÖ Yes | ‚ùå No |
| **Error Handling** | All-or-nothing | Per-question fallback |
| **Best For** | Large PDFs with clear structure | Small PDFs or when bulk fails |

---

## üîç **CODE LOCATIONS**

- **Bulk Solving:** `modules/solution_generator.py` lines 330-349
- **Bulk Parsing:** `modules/solution_generator.py` lines 507-598 (`_parse_structured_solution()`)
- **Individual Solving:** `modules/solution_generator.py` lines 356-504
- **Translation Format:** `modules/solution_generator.py` lines 610-637
- **Translation Parsing:** `modules/solution_generator.py` lines 764-821 (`_parse_translated_content()`)

